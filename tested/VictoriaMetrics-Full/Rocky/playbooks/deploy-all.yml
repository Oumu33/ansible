---
# 部署完整的 VictoriaMetrics 监控栈
- name: 部署 VictoriaMetrics 监控栈
  hosts: vm
  gather_facts: true
  become: true

  roles:
    - role: vmstorage
      when: "'vmstorage' in group_names"
    - role: vminsert
      when: "'vminsert' in group_names"
    - role: vmselect
      when: "'vmselect' in group_names"
    - role: vmauth
      when: "'vmauth' in group_names"
    - role: vmalert
      when: "'vmalert' in group_names"
    - role: vmagent
      when: "'vmagent' in group_names"
    - role: alertmanager
      when: "'alertmanager' in group_names"
    - role: grafana
      when: "'grafana' in group_names"
    - role: victorialogs
      when: "'victorialogs' in group_names"
    - role: vector
      when: "'vector' in group_names"