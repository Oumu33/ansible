---
# PostgreSQL 集群版全局变量

# 版本
postgresql_version: "16"
patroni_version: "3.1.0"
etcd_version: "3.5.10"
haproxy_version: "2.9.6"

# 安装目录
postgresql_install_dir: "/opt/postgresql"
postgresql_data_dir: "/var/lib/postgresql/data"
postgresql_config_dir: "/etc/postgresql"
postgresql_log_dir: "/var/log/postgresql"

patroni_install_dir: "/opt/patroni"
patroni_config_dir: "/etc/patroni"
patroni_log_dir: "/var/log/patroni"

etcd_install_dir: "/opt/etcd"
etcd_data_dir: "/var/lib/etcd"
etcd_config_dir: "/etc/etcd"

haproxy_install_dir: "/opt/haproxy"
haproxy_config_dir: "/etc/haproxy"
haproxy_log_dir: "/var/log/haproxy"

# 系统用户
postgresql_user: "postgres"
postgresql_group: "postgres"
patroni_user: "patroni"
patroni_group: "patroni"
etcd_user: "etcd"
etcd_group: "etcd"
haproxy_user: "haproxy"
haproxy_group: "haproxy"

# PostgreSQL 配置
postgresql_port: 5432
postgresql_listen_addresses: "0.0.0.0"
postgresql_max_connections: 200
postgresql_shared_buffers: "512MB"
postgresql_effective_cache_size: "2GB"
postgresql_maintenance_work_mem: "128MB"
postgresql_checkpoint_completion_target: 0.9
postgresql_wal_buffers: "16MB"
postgresql_default_statistics_target: 100
postgresql_random_page_cost: 1.1
postgresql_effective_io_concurrency: 200
postgresql_work_mem: "5242kB"
postgresql_min_wal_size: "1GB"
postgresql_max_wal_size: "4GB"

# Patroni 配置
patroni_scope: "postgresql-cluster"
patroni_name: "postgresql-{{ ansible_hostname }}"
patroni_restapi_port: 8008
patroni_replication_password: "replication_password"
patroni_superuser_password: "superuser_password"

# Patroni 集群配置
patroni_bootstrap_dcs_ttl: 30
patroni_bootstrap_dcs_loop_wait: 10
patroni_bootstrap_dcs_retry_timeout: 30
patroni_bootstrap_dcs_maximum_lag_on_failover: 1048576

# Etcd 配置
etcd_client_port: 2379
etcd_peer_port: 2380
etcd_initial_cluster_state: "new"
etcd_initial_cluster_token: "postgresql-cluster"

# Etcd 集群配置
etcd_servers:
  - host: "172.22.1.23"
    peer_port: 2380
    client_port: 2379
  - host: "172.22.1.24"
    peer_port: 2380
    client_port: 2379
  - host: "172.22.1.25"
    peer_port: 2380
    client_port: 2379

# HAProxy 配置
haproxy_port: 5000
haproxy_stats_port: 8404
haproxy_stats_user: "admin"
haproxy_stats_password: "admin"

# HAProxy 后端配置
haproxy_backend_servers:
  - name: postgresql-1
    host: "172.22.1.20"
    port: 5432
  - name: postgresql-2
    host: "172.22.1.21"
    port: 5432
  - name: postgresql-3
    host: "172.22.1.22"
    port: 5432

# 下载超时 (秒)
download_timeout: 1800

# 服务状态
service_state: "started"
service_enabled: true